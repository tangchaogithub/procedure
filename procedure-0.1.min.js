function Procedure(option) {
    this.obj = document.getElementById(option.id);//ID
    this.situation = option.situation;//情况
    this.bgs = option.bgs;//图片
    this.datas = option.data;//数据
    this.end = option.end;//流程结束节点
    this.kai = option.kai || 0;
    this.onclick = option.onclick;
    this.active_color = option.active_color || '#da4d00';
    this.start_color = option.start_color || '#285d94'
}

//init
Procedure.prototype.init = function () {
    var flag = this.situation;//判断的情况
    var end = this.end;
    var kai = this.kai;
    var active_color = this.active_color;
    var bgs = this.bgs;
    var onclick = this.onclick;
    var start_color = this.start_color;
    var datas = this.datas;
    var index = 0;
    var mLiw;
    var _self = this;
    _self.loads(_self, datas, flag, end, bgs, kai);
    _self.oDiv = document.getElementById('margin-auto');
    _self.Lilenght = document.getElementById('procedure-show');//中间
    _self.FriLi = document.getElementById('procedure-hide');//第一个流程
    _self.Al = document.getElementById('prev');//获取箭头
    _self.Ar = document.getElementById('next');//获取箭头
    var LDivw = document.getElementById('proc-ms');
    var ifr = document.getElementById('procedure_if');
    var aLi = _self.Lilenght.getElementsByTagName('li');//中间的li
    var len = _self.Lilenght.getElementsByTagName('li').length;
    var aLiw = 73;
    var pDiv = this.obj.offsetWidth;
    var Lal = _self.Lilenght.getElementsByTagName('a')[0];

    if (flag == 1) {
        for (var ks = 0; ks < end - 1; ks++) {
            // aLi[ks].getElementsByTagName('a')[0].className="link";
            //aLi[ks].getElementsByTagName('i')[0].style.display="none";
            aLi[ks].getElementsByTagName('span')[0].style.color = start_color;
            if ($(aLi[ks]).find('a').hasClass('active')) {
                $(aLi[ks]).find('span').css('color', active_color);
            }

        }

    } else {
        for (var ks = 0; ks < end; ks++) {
            // aLi[ks].getElementsByTagName('a')[0].className="link";
            //aLi[ks].getElementsByTagName('i')[0].style.display="none";
            aLi[ks].getElementsByTagName('span')[0].style.color = start_color;
            if ($(aLi[ks]).find('a').hasClass('active')) {
                $(aLi[ks]).find('span').css('color', active_color);
            }

        }

    }


    for (var b = 0; b < len; b++) {
        (function (k) {


            aLi[b].getElementsByTagName('a')[0].onclick = function () {
                if (this.className == "link") {
                    if (flag == 1) {
                        _self.FriLi.getElementsByTagName('a')[0].className = "link";
                        _self.FriLi.getElementsByTagName('i')[0].style.display = "none";
                        _self.FriLi.getElementsByTagName('span')[0].style.color = start_color;
                        for (var ks = 0; ks < end - 1; ks++) {
                            aLi[ks].getElementsByTagName('a')[0].className = "link";
                            aLi[ks].getElementsByTagName('i')[0].style.display = "none";
                            aLi[ks].getElementsByTagName('span')[0].style.color = start_color;
                        }
                    } else {

                        for (var ks = 0; ks < end; ks++) {
                            aLi[ks].getElementsByTagName('a')[0].className = "link";
                            aLi[ks].getElementsByTagName('i')[0].style.display = "none";
                            aLi[ks].getElementsByTagName('span')[0].style.color = start_color;
                        }
                    }


                    var url = this.getAttribute("data");

                    /* ifr.setAttribute('src',url);*/
                    this.className = "active";
                    $(this).next().css('color', active_color);
                    aLi[k - 1].getElementsByTagName('i')[0].style.display = "block";
                    //console.log(datas,k)
                    if (flag == 1) {
                        onclick(datas[k]);
                    } else {
                        onclick(datas[k - 1]);
                    }

                }
            }
        })(b + 1);
    }

    if (flag == 1) {
        _self.FriLi.getElementsByTagName('a')[0].onclick = function () {
            if (this.className == "link") {
                _self.FriLi.getElementsByTagName('span')[0].style.color = active_color;
                for (var ks = 0; ks < end - 1; ks++) {
                    aLi[ks].getElementsByTagName('a')[0].className = "link";
                    aLi[ks].getElementsByTagName('i')[0].style.display = "none";
                    aLi[ks].getElementsByTagName('span')[0].style.color = start_color;
                }
                var url = this.getAttribute("data");
                this.className = "active";
                _self.FriLi.getElementsByTagName('i')[0].style.display = "block";

                onclick(data[url]);
            }
        }
    } else {

    }
    //点击加载
    //左边切换
    _self.Al.onclick = function () {
        index--;
        var Sw = LDivw.style.width;
        Sw = parseInt(Sw);
        var max = parseInt(Sw / aLiw) + 1;
        var j = len - max;

        if (index < 0) {
            index = 0;
        } else {
            if (index == 0) {
                this.className = "prev";
            } else {
                _self.Ar.className = "next-on";
            }
            var movePx = -(index * aLiw);
            $(_self.Lilenght).stop().animate({
                left: movePx + 'px'
            }, 500);

        }

    }
    //左边切换

    //右边切换
    _self.Ar.onclick = function () {
        index++;
        var Sw = LDivw.style.width;
        Sw = parseInt(Sw);
        var max = parseInt(Sw / aLiw);
        var j = len - max;
        //判断

        if (index > j) {
            index = j;
        } else {
            if (index == j) {
                this.className = "next";
            } else {
                _self.Al.className = "prev-on";
            }

            var movePx = -(index * aLiw);
            $(_self.Lilenght).stop().animate({
                left: movePx + 'px'
            }, 500);
        }
    }
    //左边切换


}
//init

Procedure.prototype.resizeWidth = function (obj, len, width, end, datas, pic) {


    var LDivw = document.getElementById('proc-ms');
    var pDiv = obj.offsetWidth;
    var hide = document.getElementById('procedure-hide');
    var mDiv = document.getElementById('margin-auto');
    var sDiv = document.getElementById('procedure-show');
    var oAlinkL = document.getElementById('prev');
    var oAlinkR = document.getElementById('next');
    var hide_w = hide.offsetWidth;
    var fLiw = 73;
    var yuW = pDiv - fLiw;
    var Nli = len.length * width - 39;

    sDiv.style.width = (len.length - 1) * width + 74 + 'px';
    //end
    len[len.length - 1].style.width = "34px";
    len[len.length - 1].className = "end-list";

    if (end != null) {
        for (var i = end - 1; i < len.length; i++) {
            len[i].style.background = "url(" + pic + ") 12px 25px repeat-x";
            len[i].getElementsByTagName('a')[0].className = "grey";
            len[i].getElementsByTagName('img')[0].className = "opcta";
        }
    }
    //end
    // 判断

    if (Nli < yuW) {
        //居中 最后一个去处延长线
        oAlinkL.style.display = "none";//隐藏箭头
        oAlinkR.style.display = "none";//隐藏箭头
        mDiv.style.width = fLiw + (len.length - 1) * width + 74 + 'px';
        LDivw.style.width = Nli + 40 + 'px';

    } else {

        oAlinkL.style.display = "block";//显示箭头
        oAlinkR.style.display = "block";//显示箭头
        oAlinkR.className = "next-on";

        var sL = parseInt((yuW - fLiw) / 70);
        LDivw.style.width = sL * width + 74 + 'px';
        mDiv.style.width = fLiw + sL * width + 74 + 'px';

    }


    // 判断


}
Procedure.prototype.resizeWidth_t = function (obj, len, width, end, pic) {
    var LDivw = document.getElementById('proc-ms');
    var pDiv = obj.offsetWidth;

    var mDiv = document.getElementById('margin-auto');
    var sDiv = document.getElementById('procedure-show');
    var oAlinkL = document.getElementById('prev');
    var oAlinkR = document.getElementById('next');

    var yuW = pDiv;
    var Nli = len.length * width - 39;

    sDiv.style.width = (len.length - 1) * width + 74 + 'px';
    //end
    len[len.length - 1].style.width = "34px";
    len[len.length - 1].className = "end-list";

    if (end != null) {

        for (var i = end; i < len.length; i++) {
            len[i].style.background = "url(" + pic + ") 12px 25px repeat-x";
            len[i].getElementsByTagName('a')[0].className = "grey";
            len[i].getElementsByTagName('img')[0].className = "opcta";
        }
    }
    //end
    // 判断

    if (Nli < yuW) {

        //居中 最后一个去处延长线
        oAlinkL.style.display = "none";//隐藏箭头
        oAlinkR.style.display = "none";//隐藏箭头
        LDivw.style.width = (len.length - 1) * width + 74 + 'px';
        mDiv.style.width = (len.length - 1) * width + 74 + 'px';
    } else {

        oAlinkL.style.display = "block";//显示箭头
        oAlinkR.style.display = "block";//显示箭头
        oAlinkR.className = "next-on";

        var sL = parseInt((yuW) / 73);

        LDivw.style.width = sL * width + 74 + 'px';
        mDiv.style.width = sL * width + 74 + 'px';

    }


    // 判断


}

Procedure.prototype.loads = function (obj, datas, flag, end, pic, kai) {

    var Rue = document.getElementById('procedure');
    var hDiv = document.getElementById('procedure-hide');
    var ifr = document.getElementById('procedure_if');
    var sDiv = document.getElementById('procedure-show');

    //flag==1
    if (flag == 1) {
        hDiv.innerHTML = "";
        sDiv.innerHTML = "";
        aLiw = 73;
        var Li = document.createElement("li");
        Li.innerHTML = '<a data="' + datas[0].href + '" href="javascript:;"><img src="' + datas[0].icon + '" /></a><span>' + datas[0].name + '</span><i></i>';
        hDiv.appendChild(Li);
        Li.getElementsByTagName('i')[0].style.display = "none";

        for (var m = 1; m < datas.length; m++) {
            var json = datas[m];
            var Li2 = document.createElement("li");
            Li2.innerHTML = '<a data="' + datas[m].href + '" href="javascript:;" ><img src="' + datas[m].icon + '" /></a><span>' + datas[m].name + '</span><i></i>';

            sDiv.appendChild(Li2);
            Li2.getElementsByTagName('a')[0].className = "link";

            var spanOli = Li2.getElementsByTagName('span')[0];
            var span = Li2.getElementsByTagName('span')[0].innerHTML;

            switch (span.length) {
                case 2:
                    spanOli.style.left = '4px';
                    break;
                case 3:
                    spanOli.style.left = 'px';
                    break;
                case 4:
                    spanOli.style.left = '-5px';
                    break;
                case 5:
                    spanOli.style.left = '-12px';
                    break;
                case 6:
                    spanOli.style.left = '-17px';
                    break;

            }

        }

        if (kai == -1) {
            Li.getElementsByTagName('a')[0].className = "active";
            Li.getElementsByTagName('span')[0].style.color = active_color;
        } else {
            if (kai >= end) {
                Li.getElementsByTagName('a')[0].className = "active";
                Li.getElementsByTagName('i')[0].style.display = "block";
            } else {
                sDiv.getElementsByTagName('li')[kai].getElementsByTagName('a')[0].className = "active";
                sDiv.getElementsByTagName('li')[kai].getElementsByTagName('i')[0].style.display = "block";
                Li.getElementsByTagName('a')[0].className = "link";
            }

            //

        }

        //aa
        hDiv.style.display = "block";
        var aLi = sDiv.getElementsByTagName('li');
        sDiv.style.left = "0px";


        //宽度
        obj.resizeWidth(this.obj, aLi, aLiw, end, datas, pic);


    } //flag==1

    //flag==2
    if (flag == 2) {
        sDiv.innerHTML = "";
        aLiw = 73;
        for (var m = 0; m < datas.length; m++) {
            var json = datas[m];
            var Li2 = document.createElement("li");
            Li2.innerHTML = '<a data="' + datas[m].href + '" href="javascript:;"><img src="' + datas[m].icon + '" /></a><span>' + datas[m].name + '</span><i></i>';
            sDiv.appendChild(Li2);
            Li2.getElementsByTagName('a')[0].className = "link";
            var spanOli = Li2.getElementsByTagName('span')[0];
            var span = Li2.getElementsByTagName('span')[0].innerHTML;

            switch (span.length) {
                case 2:
                    spanOli.style.left = '4px';
                    break;
                case 3:
                    spanOli.style.left = '2px';
                    break;
                case 4:
                    spanOli.style.left = '-5px';
                    break;
                case 5:
                    spanOli.style.left = '-12px';
                    break;
                case 6:
                    spanOli.style.left = '-17px';
                    break;

            }
        }


        if (kai >= end) {
            sDiv.getElementsByTagName('li')[0].getElementsByTagName('a')[0].className = "active";
            sDiv.getElementsByTagName('li')[0].getElementsByTagName('i')[0].style.display = "block";
        } else if (kai <= 0) {

            sDiv.getElementsByTagName('li')[0].getElementsByTagName('a')[0].className = "active";
            sDiv.getElementsByTagName('li')[0].getElementsByTagName('i')[0].style.display = "block";
            sDiv.getElementsByTagName('li')[0].getElementsByTagName('span')[0].style.color = active_color;
        } else {
            sDiv.getElementsByTagName('li')[kai].getElementsByTagName('a')[0].className = "active";
            sDiv.getElementsByTagName('li')[kai].getElementsByTagName('i')[0].style.display = "block";
        }


        var url = sDiv.getElementsByTagName('li')[0].getElementsByTagName('a')[0].getAttribute('data');
        /*ifr.setAttribute('src',url);*/
        //aa
        var aLi = sDiv.getElementsByTagName('li');
        sDiv.style.left = "0px";
        //宽度
        obj.resizeWidth_t(this.obj, aLi, aLiw, end, datas, pic);

    } //flag==2
}
